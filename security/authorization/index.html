
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.7">
    
    
      
        <title>Authorization - APTrust Registry</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#authorization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="APTrust Registry" class="md-header__button md-logo" aria-label="APTrust Registry" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            APTrust Registry
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Authorization
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/APTrust/registry-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="APTrust Registry" class="md-nav__button md-logo" aria-label="APTrust Registry" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    APTrust Registry
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/APTrust/registry-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../structure/" class="md-nav__link">
        Code Structure
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../components/" class="md-nav__link">
        Key Code Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../requests/" class="md-nav__link">
        Requests
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Security" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Security Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../roles/" class="md-nav__link">
        Roles and Privileges
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../authentication/" class="md-nav__link">
        Authentication
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Authorization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Authorization
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#things-to-note" class="md-nav__link">
    Things to Note
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-resourceauthorization-model" class="md-nav__link">
    The ResourceAuthorization Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permission-definitions" class="md-nav__link">
    Permission Definitions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permission-mapping" class="md-nav__link">
    Permission Mapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permission-checking" class="md-nav__link">
    Permission Checking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-of-authorization-related-files" class="md-nav__link">
    List of Authorization-Related Files
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../csrf/" class="md-nav__link">
        Cross-Site Request Forgery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../headers/" class="md-nav__link">
        Default Headers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../user-management/" class="md-nav__link">
        User Management
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../institution-management/" class="md-nav__link">
        Institution Management
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../deletion/" class="md-nav__link">
        Deletion
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../restoration/" class="md-nav__link">
        Restoration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../requeuing/" class="md-nav__link">
        Requeing Work Items
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../nsq/" class="md-nav__link">
        NSQ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../redis/" class="md-nav__link">
        Redis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../ui-components/" class="md-nav__link">
        UI Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../database/" class="md-nav__link">
        Database
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../models/" class="md-nav__link">
        Data Models
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#things-to-note" class="md-nav__link">
    Things to Note
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-resourceauthorization-model" class="md-nav__link">
    The ResourceAuthorization Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permission-definitions" class="md-nav__link">
    Permission Definitions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permission-mapping" class="md-nav__link">
    Permission Mapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permission-checking" class="md-nav__link">
    Permission Checking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-of-authorization-related-files" class="md-nav__link">
    List of Authorization-Related Files
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/APTrust/registry-docs/edit/master/docs/security/authorization.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="authorization">Authorization</h1>
<p>Authorization middleware runs after authentication middleware. By the time it touches the request, the authentication middlware has added the User object to the current request.</p>
<p>The <a href="https://github.com/APTrust/registry/blob/master/middleware/authorize.go" target="_blank">authorization middlware</a> uses that User object to do the following:</p>
<ol>
<li>Check the URL/request path to see what type of resource the user is requesting. If the resource maps to a specific database record (a work item, generic file, intellectual object, etc.), it looks up the record to see which institution it belongs to.</li>
<li>Check the <a href="https://github.com/APTrust/registry/blob/master/middleware/authorization_map.go" target="_blank">authrorization map</a> to see if the user is allowed to access that particular resource belonging to that particular institution.</li>
<li>Constructs a <a href="https://github.com/APTrust/registry/blob/master/middleware/resource_authorization.go" target="_blank">ResourceAuthorization object</a> with the following information:<ul>
<li>Handler - The name of the HTTP handler function that will handle the user's request.</li>
<li>ResourceID - The unique id of the resource (work item, file, obect, etc.) the user requested. This will be zero if the user is requesting a list of items.</li>
<li>ResourceIdentifier - The string identifier of the requested resource. This applies to institutions, intellectual objects and generic files.</li>
<li>ResourceInstId - The ID of the institution to which the resource belongs.</li>
<li>ResourceType - The type of resource (IntellectualObject, WorkItem, GenericFile, etc.).</li>
<li>Permission - The permission required to access the requested resource. These are defined in <a href="https://github.com/APTrust/registry/blob/master/constants/permissions.go" target="_blank">constants/permissions</a>.</li>
<li>Checked - True or false, indicating whether the authorization middleware checked that the user has permission to access the requested resource.</li>
<li>Approved - True or false, indicating whether the user has permission to access the requested resource.</li>
<li>Error - Describes any error that occurred during the authorization check.</li>
</ul>
</li>
</ol>
<p>The authorization middleware will not let a request proceed unless the ResourceAuthorization object's <code>Checked</code> and <code>Approved</code> attrbutes are both true.</p>
<h2 id="things-to-note">Things to Note</h2>
<ol>
<li>If, when adding a new endpoint, you to forget to define a permission for it, you will never be able to reach that endpoint, because without a defined permission, <code>ResourceAuthorization.Checked</code> will be false.</li>
<li>Requests for list endpoints, such as the WorkItems list and the IntellectualObject list, cannot include a ResourceID or a ResourceInstID, because the requests don't target a single resource. Unless the requesting user is an APTrust admin, database queries issued by these requests will <strong>always</strong> include an Institution ID filter, with the ID set to the user's own institution ID. For example, when a user from virginia.edu requests a list of WorkItems, objects, or files, the system will force a where clause into their queries stating <code>where institution_id = [user's institution id]</code>. This occurs in the <code>LoadResourceList()</code> function of the Web UI's <a href="https://github.com/APTrust/registry/blob/master/web/webui/request.go" target="_blank">Request object</a> and in the <code>LoadResourceList()</code> function of the API's <a href="https://github.com/APTrust/registry/blob/master/web/api/request.go" target="_blank">Request object</a>.</li>
<li>The authorization middleware issues a lightweight query to return the model's insitution id. We want these queries to be as light as possible, since they run on every request. You'll find these queries in the <code>InstIDFor()</code> function in <a href="https://github.com/APTrust/registry/blob/master/pgmodels/pgmodel.go" target="_blank">pgmodel.go</a>.</li>
</ol>
<h2 id="the-resourceauthorization-model">The ResourceAuthorization Model</h2>
<p>The ResourceAuthorization model constructed by the authorization middleware will be used later by the request handlers. For more on that, see the <a href="../../requests/#the-resourceauthorization-model">Requests</a> page.</p>
<h2 id="permission-definitions">Permission Definitions</h2>
<p>All of Registry's permission are defined in <a href="https://github.com/APTrust/registry/blob/master/constants/permissions.go" target="_blank">constants/permissions.go</a>. The <code>initPermissions()</code> function in that file assigns permissions to roles like so:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="c1">// Institutional User Role</span><span class="w"></span>
<span class="w">    </span><span class="nx">instUser</span><span class="p">[</span><span class="nx">ChecksumRead</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">    </span><span class="nx">instUser</span><span class="p">[</span><span class="nx">DashboardShow</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ... additional permissions omitted for brevity...</span><span class="w"></span>


<span class="w">    </span><span class="c1">// Institutional Admin Role</span><span class="w"></span>
<span class="w">    </span><span class="nx">instAdmin</span><span class="p">[</span><span class="nx">FileDelete</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">    </span><span class="nx">instAdmin</span><span class="p">[</span><span class="nx">FileRead</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ... additional permissions omitted for brevity...</span><span class="w"></span>


<span class="w">    </span><span class="c1">// Sys Admin Role</span><span class="w"></span>
<span class="w">    </span><span class="nx">sysAdmin</span><span class="p">[</span><span class="nx">ChecksumCreate</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">    </span><span class="nx">sysAdmin</span><span class="p">[</span><span class="nx">ChecksumDelete</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="c1">// no one can do this</span><span class="w"></span>
<span class="w">    </span><span class="nx">sysAdmin</span><span class="p">[</span><span class="nx">ChecksumRead</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ... additional permissions omitted for brevity...</span><span class="w"></span>
</code></pre></div>
<p>Registry permissions are role-based with the following general rules:</p>
<ul>
<li>Institutional Users can access resources belonging to their own institution, but cannot perform destructive actions and manipulate other user accounts.</li>
<li>Institutional Admins can do everything Institutional Users can do, plus approve deletion requests and manipulate other user accounts at their own institution.</li>
<li>The System Administrator account has all privileges at all institutions, plus some additional privileges such as creating, editing, and deactivating institutions, managing NSQ services, re-queueing WorkItems, and other administrative tasks.</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>No role has any permission unless it is explicitly granted in <a href="https://github.com/APTrust/registry/blob/master/constants/permissions.go" target="_blank">constants/permissions.go</a>, and some permissions are explicitly denied to all users because they violate business rules.</p>
<p>For example, no user can delete checksums or delete or alter PREMIS events. The endpoints to perform these actions don't even exist, and the underlying data models will throw errors if anyone even tries to perform these actions.</p>
</div>
<h2 id="permission-mapping">Permission Mapping</h2>
<p>While permissions are defined and assigned to roles in <a href="https://github.com/APTrust/registry/blob/master/constants/permissions.go" target="_blank">constants/permissions.go</a>, they are mapped to request handlers in <a href="https://github.com/APTrust/registry/blob/master/middleware/authorization_map.go" target="_blank">middleware/authorization_map.go</a>. The authorization map tells the app which permission is required to access each request handler.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you don't map a permission to your new request handler, no one will be able to reach it, ever, because the authorization check will fail.</p>
</div>
<h2 id="permission-checking">Permission Checking</h2>
<p>The <a href="https://github.com/APTrust/registry/blob/master/middleware/authorize.go" target="_blank">middleware/authorization.go</a> middleware figures out which request handler responds to the current URL. It reads the authorization map to see which permission is required to access that handler, then determines whether the current user is allowed to call that handler. It also does further checks, as described above, to see if the user can access whatever resources that handler touches.</p>
<h2 id="list-of-authorization-related-files">List of Authorization-Related Files</h2>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/APTrust/registry/blob/master/constants/permissions.go" target="_blank">constants/permissions.go</a></td>
<td>Defines all of the system permissions and assigns them to roles at application start.</td>
</tr>
<tr>
<td><a href="https://github.com/APTrust/registry/blob/master/middleware/authorization_map.go" target="_blank">middleware/authorization_map.go</a></td>
<td>Maps permissions to web and API request handlers.</td>
</tr>
<tr>
<td><a href="https://github.com/APTrust/registry/blob/master/middleware/authorize.go" target="_blank">middleware/authorize.go</a></td>
<td>Authorizes requests and decides whether or not to pass the request on to the handler.</td>
</tr>
<tr>
<td><a href="https://github.com/APTrust/registry/blob/master/middleware/resource_authorization.go" target="_blank">middleware/resource_authorization.go</a></td>
<td>Includes logic to compare user permissions to the authorization map, and to do fine-grained resource-level checks. (I.e. Ensures objects user is requesting actually belong to that user's institution.)</td>
</tr>
<tr>
<td><a href="https://github.com/APTrust/registry/blob/master/web/webui/request.go" target="_blank">web/webui/request.go</a></td>
<td>Enforces filters in list requests to ensure users access only resources belonging to their own institution.</td>
</tr>
<tr>
<td><a href="https://github.com/APTrust/registry/blob/master/web/api/request.go" target="_blank">web/api/request/go</a></td>
<td>Enforces filters in API list requests to ensure users access only resources belonging to their own institution.</td>
</tr>
</tbody>
</table>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../authentication/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Authentication" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Authentication
            </div>
          </div>
        </a>
      
      
        
        <a href="../csrf/" class="md-footer__link md-footer__link--next" aria-label="Next: Cross-Site Request Forgery" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Cross-Site Request Forgery
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>